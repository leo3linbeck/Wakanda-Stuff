/*** @author Leo Linbeck III	requires jspdf.js or jspdf.min.js*/if (L3 === undefined) L3 = {};L3.addHeaderToPDF = function addHeaderToPDF(doc, param) {	doc.setFontSize(24);	doc.text('StrawPoll™ Sample Ballot', param.xCoord, param.yCoord);		doc.setFontSize(18);	param.yCoord += param.lineHeight;	doc.text('For the address:', param.xCoord, param.yCoord);		param.xCoord += 20;	param.yCoord += param.lineHeight;	doc.text(param.person.address1, param.xCoord, param.yCoord);	if(param.person.address2) {		param.yCoord += param.lineHeight;		doc.text(param.person.address2, param.xCoord, param.yCoord);		param.box.y += param.lineHeight;		param.box.h -= param.lineHeight;		param.maxLines--;	}	param.yCoord += param.lineHeight;	doc.text(param.person.city + ', ' + param.person.state + '  ' + param.person.zip, param.xCoord, param.yCoord);		param.yCoord += 1.5 * param.lineHeight;	doc.setFontSize(14);	doc.setFontStyle('italic');	doc.text('Election', param.xCol1 + 1, param.yCoord);	doc.text('District', param.xCol2 + 1, param.yCoord);	doc.text('Candidate', param.xCol3 + 1, param.yCoord);	doc.text('Party', param.xCol4 + 1, param.yCoord);	doc.lines([[param.line.x2 + 2, 0]], param.line.x1 - 1, param.yCoord + param.line.y, [1.0, 1.0]);}	L3.initializePDFParams = function initializePDFParams() {	var p = {		person: sources.currentPerson,		lineHeight: 10,		maxLines: 20,		xMargin: 20,		yMargin: 20,		xCol1: 25,		xCol2: 75,		xCol3: 105,		xCol4: 180,		xCol5: 190,		xCoord: 20,		yCoord: 20,		box: {},		line: {}	};		p.box = {		x: 20,		y: 58,		h: 220,		w: 180	};		p.line = {		x1: 21,		x2: 178,		y: 3	};		return p;}	L3.resetPDFParams = function resetPDFParams(p) {	p.xCoord = 20;	p.yCoord = 20;}	L3.convertBallotToPDF = function convertBallotToPDF(campaigns) {	debugger;	var doc = new jsPDF();	var pdfParams = L3.initializePDFParams();		L3.addHeaderToPDF(doc, pdfParams);		doc.setFontSize(14);	doc.setFontStyle('normal');	campaigns.toArray('districtType, districtName, candidateName, candidateParty, incumbent', {		onSuccess: function(event) {			var c = event.result;			var lineNum = 0;//				for (var i = 0; i < c.length; i++) {			for (var i = 0; i < 100; i++) {				if (lineNum++ > pdfParams.maxLines) {					doc.rect(pdfParams.box.x, pdfParams.box.y, pdfParams.box.w, pdfParams.box.h);					doc.addPage();					L3.resetPDFParams(pdfParams);					L3.addHeaderToPDF(doc, pdfParams);					doc.setFontStyle('normal');					lineNum = 1;				}				pdfParams.yCoord += pdfParams.lineHeight;				if (i < c.length) {					doc.text(c[i].districtType.trim(), pdfParams.xCol1, pdfParams.yCoord);					doc.text(c[i].districtName.trim(), pdfParams.xCol2, pdfParams.yCoord);					doc.text(c[i].candidateName.trim(), pdfParams.xCol3, pdfParams.yCoord);					doc.text(c[i].candidateParty.trim(), pdfParams.xCol4, pdfParams.yCoord);					doc.text((c[i].incumbent?' [I]':''), pdfParams.xCol5, pdfParams.yCoord);				}				else {					doc.text('MA State House', pdfParams.xCol1, pdfParams.yCoord);					doc.text('MA-HD-' + i, pdfParams.xCol2, pdfParams.yCoord);					doc.text('Franklin Delano Roosevelt', pdfParams.xCol3, pdfParams.yCoord);					doc.text('D', pdfParams.xCol4, pdfParams.yCoord);					doc.text(' [I]', pdfParams.xCol5, pdfParams.yCoord);				}				if (lineNum <= pdfParams.maxLines)					doc.lines([[pdfParams.line.x2, 0]], pdfParams.line.x1, pdfParams.yCoord + pdfParams.line.y, [1.0, 1.0]);			}			doc.rect(pdfParams.box.x, pdfParams.box.y, pdfParams.box.w, pdfParams.box.h);						var strWindowFeatures = "menubar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes";			if (L3.pdfWindow === undefined)				L3.pdfWindow = window.open('', 'Printed Ballot', strWindowFeatures);			else {				L3.pdfWindow.location = 'Printed Ballot';				L3.pdfWindow.focus();			}						doc.output('datauri');		}	});}	