/*** @author Leo Linbeck III*/function updateOrCreatePolitician(fullName, url, p, s) {	if (url == null)		var v = ds.Politician.find('fullName = :1 and state.ID = :2 and party.ID = :3', fullName, s.ID, p);	else		var v = ds.Politician.find('url = :1', url);			if ( v == null )		v = ds.Politician.createEntity();	v.fullName = fullName;	v.party = p;	v.url = url;	v.state = s;	v.save();		return v;}function updateOrCreateCampaign(e, p, i) {		if (e == null || p == null)		return null;		var v = ds.Campaign.find('politician.ID = :1 and election.ID = :2', p.ID, e.ID);		if ( v == null)		v = ds.Campaign.createEntity();		v.politician = p;	v.election = e;	v.incumbent = i;	v.save();		return v;}function updateOrCreateParty(p) {		if (p == null)		return null;		var v = ds.Party.find('party.name = :1', p);		if ( v == null) {		v = ds.Party.createEntity();		v.name = p;		v.abbreviation = p[0];		v.save();	}		return v;}function updateOrCreateDistrict(d, s) {		if (d == null)		return null;		var v = ds.District.find('state.ID = :1 and code = :2 and type = :3', s.ID, d.code, d.type);		if ( v == null)		v = ds.District.createEntity();			v.name = d.name;	v.code = d.code;	v.state = s;	v.type = d.type;	v.save();		return v;}function updateOrCreateElection(e, d) {		if (e == null)		return null;		var v = ds.Election.find('district.ID = :1 and year = :2 and type = :3', d.ID, e.year, e.type);		if ( v == null)		v = ds.Election.createEntity();			v.year = e.year;	v.district = d;	v.type = e.type;	v.primary = e.type.indexOf('Primary') != -1;	v.general = e.type.indexOf('General') != -1;	v.special = e.type.indexOf('Special') != -1;	v.runoff = e.type.indexOf('Runoff') != -1;	v.save();		return v;}function updateOrCreateBallotMeasure(s, b) {		if (b == null)		return null;		var v = ds.BallotMeasure.find('state.ID = :1 and electionDay = :2 and title = :3', s.ID, b.electionDay, b.title);		if ( v == null)		v = ds.BallotMeasure.createEntity();			v.electionDay = b.electionDay;	v.state = s;	v.type = b.type;	v.typeURL = b.typeURL;	v.title = b.title;	v.titleURL = b.titleURL;	v.subject = b.subject;	v.subjectURL = b.subjectURL;	v.description = b.description;	v.save();		return v;}exports.saveParsedData = function(parsing, debug) {	if (debug) debugger;		var parsedInfo = parsing.info;	if (parsing.type == 'legislative') {		for (var i = 0; i < parsedInfo.length; i++) {			var s = ds.State.find('name = :1', parsedInfo[i].district.state)			var d = updateOrCreateDistrict(parsedInfo[i].district, s);			var e = updateOrCreateElection(parsedInfo[i].election, d);			var v = parsedInfo[i].campaigns			for (var j = 0; j < v.length; j++) {				var q = updateOrCreateParty(v[j].party);				var p = updateOrCreatePolitician(v[j].name, v[j].url, q, s);				var c = updateOrCreateCampaign(e, p, v[j].incumbent);			}		}	}	else {		var p = parsedInfo[0];		var s = ds.State.find('ID = :1', p.state)		var m = p.measures;		for (var i = 0; i < m.length; i++) {			updateOrCreateBallotMeasure(s, m[i]);		}	}		return ('Success!');}